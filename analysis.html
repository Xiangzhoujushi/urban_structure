<!DOCTYPE html>
  
  <head>
    <!-- build a map with the slide bar to show the change of buildings throw time-->
    <!-- insert the map as the background and use the datapoints from the dataset -->

    

    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script src="https://d3js.org/d3.v4.min.js"></script>
    <script src="https://code.highcharts.com/highcharts.js"></script>
    <script src="https://code.highcharts.com/modules/data.js"></script>
    <script src="https://code.highcharts.com/modules/drilldown.js"></script>

    <!-- <script type='text/javascript' src="analysis.js"></script> -->



    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>

    <style>
        h2{
          color: blue;
        }
        #main-content {
          margin-top:50px;
          margin-left:100px;
        } 
       
    </style>
    <!-- A list that functions as a nav bar -->


    <script>
      let fileName = 'buildings_group.csv'

    d3.csv(fileName, initiate, load_data);

    function initiate(d){
      //X,Y,B1_PER_TYPE,ISSUED_YEAR
      result = {year: d['ISSUED_YEAR'],type: d['B1_PER_TYPE'], count:parseInt(d['count']), percent: parseFloat(d['percentage'])}  
            // incomeWithExpenditure.push(result);
      return result;  
    } 
     
    function loadingHighCharts(data1, data2){
      console.log(data2[0])
      Highcharts.chart('container', {
        chart:{
          type:'pie'
        },
        title:{
          text:'Buildings in Recent Years'
        },
      // subtitle: {
     //        text: 'Click the slices to view versions. Source: <a href="http://statcounter.com" target="_blank">statcounter.com</a>'
     //    },
        plotOptions: {
            series: {
                dataLabels: {
                    enabled: true,
                    format: '{point.name}: {point.y}'
                }
            }
        },

        tooltip: {
            headerFormat: '<span style="font-size:11px">{series.name}</span><br>',
            pointFormat: '<span style="color:{point.color}">{point.name}</span>: <b>{point.y}</b> of total<br/>'
        },

        "series": data1,

        "drilldown": {
          "series":data2
        }
        
      })


    }

    function load_data(error,data){
      if (error) throw error;

      //Create a hash 
      buildingHash = {};

      // print the original data
      // console.log(data[0].count+1)
      //process the js data group by year first
      data.forEach(function(d,i){
        if (!(d.type in buildingHash)){
          // console.log(d.count)
          buildingHash[d.type] = d.count;
        }else{
          buildingHash[d.type] += d.count;
        }
      })  

      data1 = [];
      data2 = [];
      // console.log(buildingHash)
      // iterate over the key, building the objects
      for(var key in buildingHash){
        data1.push(
          {"name":key,
          "y": buildingHash[key],
          "drilldown": key
          }
        );
      }

      yearHash = {}
      for(key in buildingHash){
          yearHash[key] = []
          data.forEach(function(d,i){
            if(d.type==key){
              yearHash[key].push([d.year,d.count])
          }
        })
      }

      //
      console.log(data1[0])
      
      // build the data for the first layer
      dataByBuilding = [{
        "name":"Buildings",
        "colorByPoint":true,
        "data":data1 }]

      // console.log(dataByBuilding)

      for(key in buildingHash){
        data2.push(
        {"name":key,
         "id": key,
         "data":yearHash[key]
        })
      }
      // loading the high charts
      loadingHighCharts(dataByBuilding, data2)

      

    }

// read the files
      
    </script>

  </head>

  <body>
    <!-- navigation bars -->
    <div>
     <nav class="navbar navbar-expand-lg navbar-light" style="background-color: #e3f2fd;">
        <div class="container-fluid">
          <div class="navbar-header">
            <a class="navbar-brand" href="index.html">City of Columbus</a>
          </div>
          <ul class="nav navbar-nav">
            <li><a href="index.html">Home</a></li>
            <li class="active"><a href="map_interaction.html">Interactive Map</a></li>
            <li><a href="analysis.html">Data Analysis</a></li>
          </ul>
          <!-- <button class="btn btn-danger navbar-btn">Button</button> -->
        </div>
      </nav>
    </div>

    <!-- The main content -->
    <div ID="main-content">
       <h2>Data Analysis</h2>

       <div ID = "container">
         

       </div>

    </div>
    

  </body>


</html>